<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nuestra B√≥veda: Mayda & Abel üß≠</title>
    
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">

    <style>
        body { 
            margin: 0;
            background: #ffe5ec;
            font-family: 'Segoe UI', Arial, sans-serif;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            padding-bottom: 100px;
        }

        /* LLUVIA DE ROSAS, CORAZONES Y FLORES */
        .caida {
            position: fixed;
            top: -50px;
            user-select: none;
            pointer-events: none;
            z-index: 1;
            animation: bajar linear forwards;
            font-size: 24px;
        }

        @keyframes bajar {
            to {
                transform: translateY(110vh) rotate(360deg);
            }
        }

        .tarjeta { 
            z-index: 10;
            background: white;
            padding: 25px;
            border-radius: 30px; 
            box-shadow: 0 10px 30px rgba(255, 77, 109, 0.2);
            width: 90%;
            max-width: 400px;
            border: 2px solid #ff4d6d;
            text-align: center;
            margin-bottom: 20px;
        }

        .foto-marco { 
            width: 100%;
            height: 300px;
            border-radius: 20px;
            overflow: hidden; 
            background: #fff0f3;
            border: 3px solid #ffc2d1;
            margin-bottom: 15px;
        }

        img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        button { 
            background: #ff4d6d;
            color: white;
            border: none;
            padding: 12px; 
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            margin-top: 10px;
            transition: 0.3s;
        }

        button:hover {
            transform: scale(1.02);
            background: #c9184a;
        }

        .btn-estado { 
            background: #fff0f3;
            color: #c9184a;
            border: 1px solid #ffb3c1; 
            font-size: 0.8rem;
            padding: 10px;
            margin: 4px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
        }

        .selector-musica {
            width: 100%;
            padding: 10px;
            border-radius: 15px;
            border: 1px solid #ff4d6d;
            margin-bottom: 10px;
            background: #fff0f3;
            color: #c9184a;
            font-weight: bold;
        }

        /* DISE√ëO DEL CHAT CON LADOS Y COLORES */
        .contenedor-chat {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 350px;
            overflow-y: auto;
            padding: 15px; 
            background: #fffafb;
            border-radius: 20px;
            border: 1px solid #ffe5ec;
        }

        .burbuja-nota {
            max-width: 85%;
            padding: 10px 15px;
            border-radius: 18px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            position: relative;
        }

        /* Lados */
        .nota-der {
            align-self: flex-end;
            border-bottom-right-radius: 2px;
            text-align: right;
        }

        .nota-izq {
            align-self: flex-start;
            border-bottom-left-radius: 2px;
            text-align: left;
        }

        /* Colores por Modo */
        .color-cari√±oso { background: #ffccd5; color: #c9184a; }
        .color-tristezadesahogo { background: #dbeafe; color: #1e40af; }
        .color-plan { background: #374151; color: #ffffff; }
        .color-inspiraci√≥n { background: #fef3c7; color: #92400e; }
        .color-general { background: #f3f4f6; color: #374151; }

        /* EFECTOS ESPECIALES */
        .besito-volador {
            position: fixed;
            pointer-events: none;
            z-index: 9999;
            font-size: 35px;
            animation: volar 2s ease-out forwards;
        }

        @keyframes volar {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-80vh) scale(2) rotate(45deg); opacity: 0; }
        }

        .chispa {
            position: absolute;
            pointer-events: none;
            z-index: 100;
            font-size: 20px;
            animation: explotar 1s ease-out forwards;
        }

        @keyframes explotar {
            0% { transform: scale(0); opacity: 1; }
            100% { transform: translate(var(--x), var(--y)) scale(1.2); opacity: 0; }
        }

        .globo-corazon {
            position: fixed;
            font-size: 0;
            width: 80px;
            height: 70px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23FF69B4"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>');
            background-size: contain;
            background-repeat: no-repeat;
            pointer-events: none;
            z-index: 999;
            opacity: 0.9;
            animation: flotar 3s ease-out forwards;
            bottom: -100px;
            transform-origin: bottom center;
        }

        @keyframes flotar {
            0% { transform: translateY(0) scale(0.5); opacity: 0; }
            50% { opacity: 1; transform: translateY(-50vh) scale(1); }
            100% { transform: translateY(-120vh) scale(1.2); opacity: 0; }
        }
    </style>
</head>
<body onmouseover="reproducirMusica()" onclick="reproducirMusica()" ontouchstart="reproducirMusica()">

    <audio id="musicaFondo" loop autoplay>
        <source id="audioSource" src="https://res.cloudinary.com/dvm2v0zvr/video/upload/v1771137815/Kali_Uchis_Cris_MJ_-_Si_No_Es_Contigo_REMIX_-_No_Jhayco_sin_Jhayco_e1vfkb.mp3" type="audio/mpeg">
    </audio>

    <div class="tarjeta">
        <h2 style="color: #ff4d6d; margin: 0 0 10px 0;">üåπ Nuestro Universo üåπ</h2>
        <select class="selector-musica" onchange="cambiarMelodia(this.value)">
            <option value="https://res.cloudinary.com/dvm2v0zvr/video/upload/v1771137815/Kali_Uchis_Cris_MJ_-_Si_No_Es_Contigo_REMIX_-_No_Jhayco_sin_Jhayco_e1vfkb.mp3">Kali Uchis - Si No Es Contigo</option>
            <option value="https://res.cloudinary.com/dvm2v0zvr/video/upload/v1771137817/A_700_Km_Con_Elena_skt67k.mp3">Porta - A 700 Km üéß</option>
            <option value="https://res.cloudinary.com/dvm2v0zvr/video/upload/v1771137816/Cristian_Castro_-_Nunca_Voy_a_Olvidarte_-_Primera_Fila__D√≠a_1_En_Directo_ogvw25.mp3">Cristian Castro - Nunca Voy a Olvidarte</option>
            <option value="https://res.cloudinary.com/dvm2v0zvr/video/upload/v1771137816/Jeanette_-_Coraz√≥n_De_Poeta_Actuaci√≥n_TVE_wdgalg.mp3">Jeanette - Coraz√≥n De Poeta</option>
        </select>
        <button onclick="hechizoAmuleto()" style="background: linear-gradient(45deg, #ffd700, #ffa500); border: 1px solid white;">üíç Amuleto del 26/01</button>
    </div>

    <div class="tarjeta" style="border-color: #ffb3c1;">
        <h3 style="color: #c9184a; margin: 0;">üß≠ Tu Norte: Abel</h3>
        <p id="mensajeNorte" style="color: #ff4d6d; font-size: 0.9rem; margin: 10px 0; min-height: 45px;">
            ¬øC√≥mo est√° tu coraz√≥n hoy, Mayda?
        </p>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
            <button class="btn-estado" onclick="apoyo('estresada')">Estresada üò´</button>
            <button class="btn-estado" onclick="apoyo('triste')">Miedo/Tristeza ‚òÅÔ∏è</button>
            <button class="btn-estado" onclick="apoyo('cari√±osa')">Cari√±osa ü•∞</button>
            <button class="btn-estado" onclick="apoyo('accion')">Modo Acci√≥n üíº</button>
        </div>
        <hr style="border: 0; border-top: 1px dashed #ffb3c1; margin: 15px 0;">
        <h4 style="color: #ff4d6d; margin: 0;">üíã Mis Besos</h4>
        <div id="contadorBesos" style="font-size: 2.5rem; font-weight: bold; color: #ff4d6d; margin: 5px 0;">0</div>
        <button onclick="darBeso()" style="border-radius: 30px; box-shadow: 0 4px 15px rgba(255, 77, 109, 0.4);">Enviar Beso üòò</button>
    </div>

    <div class="tarjeta" style="background: #fffdf5; border: 2px solid #d7c49e;">
        <h3 style="color: #5d4037;">üìú Refugio de Notas</h3>
        <form action="/nueva_nota" method="POST">
            <select name="autor_nombre" class="selector-musica">
                <option value="Mayda">Soy Mayda üåπ</option>
                <option value="Abel">Soy Abel üß≠</option>
            </select>
            <select name="modo_nota" class="selector-musica">
                <option value="Cari√±oso">Modo Cari√±oso ü•∞</option>
                <option value="Tristeza/Desahogo">Modo Tristeza/Desahogo ‚òÅÔ∏è</option>
                <option value="Plan">Modo Plan/Idea üé¨</option>
                <option value="Inspiraci√≥n">Modo Inspiraci√≥n ‚ú®</option>
            </select>
            <textarea name="contenido_nota" placeholder="Escribe aqu√≠..." required style="width: 90%; height: 70px; padding: 10px; border-radius: 10px; border: 1px solid #d7c49e; margin-top: 10px;"></textarea>
            <button type="submit" style="background: #5d4037;">Guardar en la B√≥veda ‚ú®</button>
        </form>

        <div class="contenedor-chat">
            {% for nota in notas %}
            <div class="burbuja-nota {{ 'nota-der' if nota[0] == 'Abel' else 'nota-izq' }} color-{{ nota[3]|lower|replace('/', '')|replace(' ', '') }}">
                <strong style="font-size: 0.75rem;">{{ nota[0] }} ({{ nota[3] }}):</strong>
                <p style="margin: 3px 0; font-size: 0.9rem;">{{ nota[1] }}</p>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 5px;">
                    <small style="font-size: 0.65rem; opacity: 0.6;">{{ nota[2] }}</small>
                    <div style="display: flex; gap: 8px;">
                        
                        <button onclick="editarNota('{{ nota[4] }}', '{{ nota[1] }}')" style="background:none; border:none; padding:0; cursor:pointer; font-size:0.8rem; width:auto; margin:0;">‚úèÔ∏è</button>
                        
                        <form action="/eliminar_nota/{{ nota[4] }}" method="POST" onsubmit="return confirm('¬øBorrar mensaje?');" style="margin:0;">
                            <button type="submit" style="background:none; border:none; padding:0; cursor:pointer; font-size:0.8rem; width:auto; margin:0;">üóëÔ∏è</button>
                        </form>

                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <div class="tarjeta">
        <h3 style="color: #ff4d6d;">Nuestros Recuerdos üì∏</h3>
        {% if fotos %}
            {% for foto in fotos %}
            <div style="margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid #ffe5ec;">
                <div class="foto-marco"><img src="{{ foto[0] }}"></div>
                <p style="color: #c9184a; font-weight: bold;">{{ foto[1] }}</p>
                
                <div style="display: flex; flex-direction: column; gap: 5px; margin-top: 10px;">
                    
                    <form action="/editar/{{ foto[2] }}" method="POST" style="display: flex; flex-direction: column; gap: 5px; align-items: center;">
                        <input type="text" name="mensaje_editado" placeholder="Escribe el nuevo nombre..." required 
                               style="width: 90%; padding: 10px; border-radius: 15px; border: 1px solid #ffb3c1; font-size: 0.8rem;">
                        
                        <button type="submit" style="background: #4caf50; width: 90%; margin: 5px auto; padding: 8px; font-size: 0.8rem; display: flex; align-items: center; justify-content: center; gap: 5px;">
                            üíæ Guardar Nuevo Nombre
                        </button>
                    </form>
                    
                    <form action="/eliminar/{{ foto[2] }}" method="POST" onsubmit="return confirm('¬øBorrar este recuerdo, amor?');" style="width: 100%; display: flex; justify-content: center;">
                        <button type="submit" style="background: #ff4d6d; width: 90%; margin: 0 auto; padding: 8px; font-size: 0.8rem; display: flex; align-items: center; justify-content: center; gap: 5px;">
                            üóëÔ∏è Borrar Foto
                        </button>
                    </form>

                </div>
            </div>
            {% endfor %}
        {% endif %}
    </div>

    <div class="tarjeta">
        <h3 style="color: #ff4d6d;">Subir Foto Nueva</h3>
        <form action="/subir" method="POST" enctype="multipart/form-data">
            <input type="file" name="foto_usuario" accept="image/*" required>
            <textarea name="mensaje_usuario" placeholder="¬øQu√© quieres decir sobre esta foto?" required style="width: 90%; margin-top: 10px; border-radius: 10px; border: 1px solid #ffb3c1; padding: 10px;"></textarea>
            <button type="submit" style="background: #4caf50;">A√±adir Foto</button>
        </form>
    </div>

    <script>
        function editarNota(id, texto) {
            const nuevo = prompt("Edita tu mensaje:", texto);
            if (nuevo) {
                const f = document.createElement('form');
                f.method = 'POST';
                f.action = '/editar_nota/' + id;
                const i = document.createElement('input');
                i.type = 'hidden';
                i.name = 'contenido_editado';
                i.value = nuevo;
                f.appendChild(i);
                document.body.appendChild(f);
                f.submit();
            }
        }

        const iconos = ['üåπ', '‚ù§Ô∏è', 'üíñ', '‚ú®', 'üå∏'];

        function crearLluvia() {
            const e = document.createElement('div');
            e.className = 'caida';
            e.innerText = iconos[Math.floor(Math.random() * iconos.length)];
            e.style.left = Math.random() * 100 + "vw";
            e.style.animationDuration = (Math.random() * 3 + 2) + "s";
            document.body.appendChild(e);
            setTimeout(() => e.remove(), 5000);
        }

        setInterval(crearLluvia, 300);

        const audio = document.getElementById('musicaFondo');
        let iniciada = false;

        function reproducirMusica() {
            if(!iniciada) {
                audio.play().catch(()=>{});
                iniciada = true;
            }
        }

        function apoyo(estado) {
            const texto = document.getElementById('mensajeNorte');
            if(estado === 'estresada') texto.innerHTML = "<b>T√≥mate un respiro, amor.</b> Abel est√° aqu√≠. ‚òÅÔ∏è";
            if(estado === 'triste') texto.innerHTML = "<b>No temas a tus miedos.</b> Soy tu refugio. üõ°Ô∏è";
            if(estado === 'cari√±osa') texto.innerHTML = "<b>¬°Qu√© linda te pones!</b> üíç";
            if(estado === 'accion') texto.innerHTML = "<b>¬°A darle con todo!</b> üß≠";
            reproducirMusica();
        }

        function darBeso() {
            const cont = document.getElementById('contadorBesos');
            cont.innerText = parseInt(cont.innerText) + 1;
            reproducirMusica();
            
            for(let i=0; i<10; i++) {
                const b = document.createElement('div');
                b.className = 'besito-volador';
                b.innerText = 'üòò';
                b.style.left = (Math.random() * 80 + 10) + "vw";
                b.style.top = "90vh";
                document.body.appendChild(b);
                setTimeout(() => b.remove(), 2000);
            }

            for(let i=0; i<3; i++) {
                const globo = document.createElement('div');
                globo.className = 'globo-corazon';
                globo.style.left = (Math.random() * 80 + 10) + "vw";
                document.body.appendChild(globo);
                setTimeout(() => globo.remove(), 3000);
            }
        }

        function hechizoAmuleto() {
            audio.play();
            for (let i = 0; i < 40; i++) {
                const c = document.createElement('div');
                c.className = 'chispa';
                c.innerText = '‚ú®';
                c.style.left = '50vw';
                c.style.top = '30vh';
                const x = (Math.random() - 0.5) * 600 + 'px';
                const y = (Math.random() - 0.5) * 600 + 'px';
                c.style.setProperty('--x', x);
                c.style.setProperty('--y', y);
                document.body.appendChild(c);
                setTimeout(() => c.remove(), 1000);
            }
            alert("¬°Promesa Eterna! Abel & Mayda üíç");
        }

        function cambiarMelodia(url) {
            document.getElementById('audioSource').src = url;
            audio.load();
            audio.play();
            iniciada = true;
        }
    </script>
</body>
</html>
